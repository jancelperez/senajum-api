'use strict';
// ava es para poder realizar los test

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _micro = require('micro');

var _micro2 = _interopRequireDefault(_micro);

var _testListen = require('test-listen');

var _testListen2 = _interopRequireDefault(_testListen);

var _requestPromise = require('request-promise');

var _requestPromise2 = _interopRequireDefault(_requestPromise);

var _pictures = require('../pictures');

var _pictures2 = _interopRequireDefault(_pictures);

var _fixtures = require('./fixtures');

var _fixtures2 = _interopRequireDefault(_fixtures);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// importamos el modulu pictures el cual creamos para el sistema de enrutamiento


// test-liste es una herramienta que me permite hacer test con microservicios
_ava2.default.beforeEach(async t => {
  let servidor = (0, _micro2.default)(_pictures2.default);
  t.context.url = await (0, _testListen2.default)(servidor);
});

// GET /id es la primera ruta la cual es un test asincrono


// request-promise permite hacer http utilizando promesas


// send es el metodo para enviar respuestas
(0, _ava2.default)('GET /:id', async t => {
  // generar un id como si fuera el id de la imagen
  let imagen = _fixtures2.default.getImagen();

  // listen retorna una url con url y puerto con el cual el servidor esta corriendo el puerto lo crea listen
  // listenn retorna una promesa
  let url = t.context.url;

  // hacer la peticion http diciendo que nos devuelva los datos en json
  let body = await (0, _requestPromise2.default)({ uri: `${url}/${imagen.publicId}`, json: true });

  // con deepEquual validar que la imagen que tubo de esa ruta (body) es igual al objeto que obtiene de getImagen()
  t.deepEqual(body, imagen);

  console.log(`${url}/${imagen.publicId} esto es una prueba`);
});
// una de las caracteristicas de ava es definir el test sin implementar el test esto lo puedo hacer con todo
(0, _ava2.default)('POST /', async t => {
  let imagen = _fixtures2.default.getImagen();
  let url = t.context.url;

  let options = {
    method: 'POST',
    url: url,
    json: true,
    body: {
      description: imagen.description,
      src: imagen.src,
      UserId: imagen.userId
    },
    resolveWithFullResponse: true
  };

  let response = await (0, _requestPromise2.default)(options);

  t.is(response.statusCode, 201);
  t.deepEqual(response.body, imagen);
});

_ava2.default.todo('POST/:/like');
//# sourceMappingURL=..\node_modules\.cache\ava\41e8ba4be4276a639ae71bbcb1884025.js.map